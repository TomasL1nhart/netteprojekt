var W=Object.defineProperty;var P=h=>{throw TypeError(h)};var Q=(h,t,e)=>t in h?W(h,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):h[t]=e;var $=(h,t,e)=>Q(h,typeof t!="symbol"?t+"":t,e),D=(h,t,e)=>t.has(h)||P("Cannot "+e);var A=(h,t,e)=>(D(h,t,"read from private field"),e?e.call(h):t.get(h)),z=(h,t,e)=>t.has(h)?P("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(h):t.set(h,e),V=(h,t,e,i)=>(D(h,t,"write to private field"),i?i.call(h,e):t.set(h,e),e),S=(h,t,e)=>(D(h,t,"access private method"),e);function X(h){return h&&h.__esModule&&Object.prototype.hasOwnProperty.call(h,"default")?h.default:h}var R={exports:{}};/*!
 * NetteForms - simple form validation.
 *
 * This file is part of the Nette Framework (https://nette.org)
 * Copyright (c) 2004 David Grudl (https://davidgrudl.com)
 */var Y=R.exports,K;function Z(){return K||(K=1,(function(h,t){(function(e,i){h.exports=i()})(Y,(function(){var p,w,y,g,q,H,G;class e{filled(r,s,n){return n!==""&&n!==!1&&n!==null&&(!Array.isArray(n)||n.length>0)&&(!(n instanceof FileList)||n.length>0)}blank(r,s,n){return!this.filled(r,s,n)}valid(r,s){return s.validateControl(r,void 0,!0)}equal(r,s,n){if(s===void 0)return null;let l=E=>typeof E=="number"||typeof E=="string"?""+E:E===!0?"1":"",c=Array.isArray(n)?n:[n],d=Array.isArray(s)?s:[s];t:for(let E of c){for(let m of d)if(l(E)===l(m))continue t;return!1}return c.length>0}notEqual(r,s,n){return s===void 0?null:!this.equal(r,s,n)}minLength(r,s,n){return n=typeof n=="number"?n.toString():n,n.length>=s}maxLength(r,s,n){return n=typeof n=="number"?n.toString():n,n.length<=s}length(r,s,n){return n=typeof n=="number"?n.toString():n,s=Array.isArray(s)?s:[s,s],(s[0]===null||n.length>=s[0])&&(s[1]===null||n.length<=s[1])}email(r,s,n){return/^("([ !#-[\]-~]|\\[ -~])+"|[-a-z0-9!#$%&'*+/=?^_`{|}~]+(\.[-a-z0-9!#$%&'*+/=?^_`{|}~]+)*)@([0-9a-z\u00C0-\u02FF\u0370-\u1EFF]([-0-9a-z\u00C0-\u02FF\u0370-\u1EFF]{0,61}[0-9a-z\u00C0-\u02FF\u0370-\u1EFF])?\.)+[a-z\u00C0-\u02FF\u0370-\u1EFF]([-0-9a-z\u00C0-\u02FF\u0370-\u1EFF]{0,17}[a-z\u00C0-\u02FF\u0370-\u1EFF])?$/i.test(n)}url(r,s,n,l){return/^[a-z\d+.-]+:/.test(n)||(n="https://"+n),/^https?:\/\/((([-_0-9a-z\u00C0-\u02FF\u0370-\u1EFF]+\.)*[0-9a-z\u00C0-\u02FF\u0370-\u1EFF]([-0-9a-z\u00C0-\u02FF\u0370-\u1EFF]{0,61}[0-9a-z\u00C0-\u02FF\u0370-\u1EFF])?\.)?[a-z\u00C0-\u02FF\u0370-\u1EFF]([-0-9a-z\u00C0-\u02FF\u0370-\u1EFF]{0,17}[a-z\u00C0-\u02FF\u0370-\u1EFF])?|\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}|\[[0-9a-f:]{3,39}\])(:\d{1,5})?(\/\S*)?$/i.test(n)?(l.value=n,!0):!1}regexp(r,s,n){let l=typeof s=="string"?s.match(/^\/(.*)\/([imu]*)$/):!1;try{return l&&new RegExp(l[1],l[2].replace("u","")).test(n)}catch{return null}}pattern(r,s,n,l,c){if(typeof s!="string")return null;try{let d;try{d=new RegExp("^(?:"+s+")$",c?"ui":"u")}catch{d=new RegExp("^(?:"+s+")$",c?"i":"")}return n instanceof FileList?Array.from(n).every(E=>d.test(E.name)):d.test(n)}catch{return null}}patternCaseInsensitive(r,s,n){return this.pattern(r,s,n,null,!0)}numeric(r,s,n){return/^[0-9]+$/.test(n)}integer(r,s,n,l){return/^-?[0-9]+$/.test(n)?(l.value=parseFloat(n),!0):!1}float(r,s,n,l){return n=n.replace(/ +/g,"").replace(/,/g,"."),/^-?[0-9]*\.?[0-9]+$/.test(n)?(l.value=parseFloat(n),!0):!1}min(r,s,n){return Number.isFinite(s)&&(n=parseFloat(n)),n>=s}max(r,s,n){return Number.isFinite(s)&&(n=parseFloat(n)),n<=s}range(r,s,n){if(Array.isArray(s)){if(r.type==="time"&&s[0]>s[1])return n>=s[0]||n<=s[1]}else return null;return(s[0]===null||this.min(r,s[0],n))&&(s[1]===null||this.max(r,s[1],n))}submitted(r){return r.form["nette-submittedBy"]===r}fileSize(r,s,n){return Array.from(n).every(l=>l.size<=s)}mimeType(r,s,n){let l=[];s=Array.isArray(s)?s:[s],s.forEach(d=>l.push("^"+d.replace(/([^\w])/g,"\\$1").replace("\\*",".*")+"$"));let c=new RegExp(l.join("|"));return Array.from(n).every(d=>!d.type||c.test(d.type))}image(r,s,n){return this.mimeType(r,s??["image/gif","image/png","image/jpeg","image/webp"],n)}static(r,s){return s}}class i{constructor(){z(this,g);$(this,"formErrors",[]);$(this,"validators",new e);z(this,p,{});z(this,w,{});z(this,y,new WeakMap)}getValue(r){var s,n;return r instanceof HTMLInputElement?r.type==="radio"?((s=S(this,g,H).call(this,r).find(l=>l.checked))==null?void 0:s.value)??null:r.type==="file"?r.files:r.type==="checkbox"?r.name.endsWith("[]")?S(this,g,H).call(this,r).filter(l=>l.checked).map(l=>l.value):r.checked:r.value.trim():r instanceof HTMLSelectElement?r.multiple?Array.from(r.selectedOptions,l=>l.value):((n=r.selectedOptions[0])==null?void 0:n.value)??null:r instanceof HTMLTextAreaElement?r.value:r instanceof RadioNodeList?this.getValue(r[0]):null}getEffectiveValue(r,s=!1){let n=this.getValue(r);if(n===r.getAttribute("data-nette-empty-value")&&(n=""),s&&A(this,p)[r.name]===void 0){A(this,p)[r.name]=!0;let l={value:n};this.validateControl(r,void 0,!0,l),n=l.value,delete A(this,p)[r.name]}return n}validateControl(r,s,n=!1,l,c){s??(s=JSON.parse(r.getAttribute("data-nette-rules")??"[]")),l??(l={value:this.getEffectiveValue(r)}),c??(c=!this.validateRule(r,":filled",null,l));for(let d of s){let E=d.op.match(/(~)?([^?]+)/),m=d.control?S(this,g,q).call(this,r.form,d.control):r;if(d.neg=!!E[1],d.op=E[2],d.condition=!!d.rules,m){if(c&&!d.condition&&d.op!==":filled")continue}else continue;let v=this.validateRule(m,d.op,d.arg,r===m?l:void 0);if(v!==null){if(d.neg&&(v=!v),d.condition&&v){if(!this.validateControl(r,d.rules,n,l,d.op===":blank"?!1:c))return!1}else if(!d.condition&&!v){if(this.isDisabled(m))continue;if(!n){let M=Array.isArray(d.arg)?d.arg:[d.arg],b=d.msg.replace(/%(value|\d+)/g,(U,j)=>this.getValue(j==="value"?m:r.form.elements.namedItem(M[j].control)));this.addError(m,b)}return!1}}}return!0}validateForm(r,s=!1){let n=r.form??r,l;if(this.formErrors=[],r.getAttribute("formnovalidate")!==null){let d=JSON.parse(r.getAttribute("data-nette-validation-scope")??"[]");if(d.length)l=new RegExp("^("+d.join("-|")+"-)");else return this.showFormErrors(n,[]),!0}for(let d of n.elements)if(d.willValidate&&d.validity.badInput)return d.reportValidity(),!1;for(let d of n.elements)if(d.getAttribute("data-nette-rules")&&(!l||d.name.replace(/]\[|\[|]|$/g,"-").match(l))&&!this.isDisabled(d)&&!this.validateControl(d,void 0,s)&&!this.formErrors.length)return!1;let c=!this.formErrors.length;return this.showFormErrors(n,this.formErrors),c}isDisabled(r){return r.type==="radio"?S(this,g,H).call(this,r).every(s=>s.disabled):r.disabled}addError(r,s){this.formErrors.push({element:r,message:s})}showFormErrors(r,s){let n=[],l;for(let c of s)n.indexOf(c.message)<0&&(n.push(c.message),l??(l=c.element));n.length&&this.showModal(n.join(`
`),()=>{l==null||l.focus()})}showModal(r,s){let n=document.createElement("dialog");if(!n.showModal){alert(r),s();return}let l=document.createElement("style");l.innerText=".netteFormsModal { text-align: center; margin: auto; border: 2px solid black; padding: 1rem } .netteFormsModal button { padding: .1em 2em }";let c=document.createElement("button");c.innerText="OK",c.onclick=()=>{n.remove(),s()},n.setAttribute("class","netteFormsModal"),n.innerText=r+`

`,n.append(l,c),document.body.append(n),n.showModal()}validateRule(r,s,n,l){if(r.validity.badInput)return s===":filled";l??(l={value:this.getEffectiveValue(r,!0)});let c=s.charAt(0)===":"?s.substring(1):s;c=c.replace("::","_").replaceAll("\\","");let d=Array.isArray(n)?n:[n];return d=d.map(E=>{if(E!=null&&E.control){let m=S(this,g,q).call(this,r.form,E.control);return m===r?l.value:this.getEffectiveValue(m,!0)}return E}),c==="valid"&&(d[0]=this),this.validators[c]?this.validators[c](r,Array.isArray(n)?d:d[0],l.value,l):null}toggleForm(r,s){V(this,w,{});for(let n of Array.from(r.elements))n.getAttribute("data-nette-rules")&&this.toggleControl(n,void 0,null,!s);for(let n in A(this,w))this.toggle(n,A(this,w)[n].state,A(this,w)[n].elem,s)}toggleControl(r,s,n=null,l=!1,c,d){var v,M;s??(s=JSON.parse(r.getAttribute("data-nette-rules")??"[]")),c??(c={value:this.getEffectiveValue(r)}),d??(d=!this.validateRule(r,":filled",null,c));let E=!1,m;for(let b of s){let U=b.op.match(/(~)?([^?]+)/),j=b.control?S(this,g,q).call(this,r.form,b.control):r;if(b.neg=!!U[1],b.op=U[2],b.condition=!!b.rules,j){if(d&&!b.condition&&b.op!==":filled")continue}else continue;if(m=n,n!==!1){if(m=this.validateRule(j,b.op,b.arg,r===j?c:void 0),m===null)continue;b.neg&&(m=!m),b.condition||(n=m)}if(b.condition&&this.toggleControl(r,b.rules,m,l,c,b.op===":blank"?!1:d)||b.toggle){E=!0,l&&S(this,g,H).call(this,j).filter(F=>!A(this,y).has(F)).forEach(F=>{F.addEventListener("change",J=>this.toggleForm(r.form,J)),A(this,y).set(F,null)});for(let F in b.toggle??{})(v=A(this,w))[F]??(v[F]={elem:r,state:!1}),(M=A(this,w)[F]).state||(M.state=b.toggle[F]?!!m:!m)}}return E}toggle(r,s,n,l){/^\w[\w.:-]*$/.test(r)&&(r="#"+r),Array.from(document.querySelectorAll(r)).forEach(c=>c.hidden=!s)}compactCheckboxes(r,s){var l;let n={};for(let c of r.elements)c instanceof HTMLInputElement&&c.type==="checkbox"&&c.name.endsWith("[]")&&c.checked&&!c.disabled&&(s.delete(c.name),n[l=c.name]??(n[l]=[]),n[c.name].push(c.value));for(let c in n)s.set(c.substring(0,c.length-2),n[c].join(","))}initForm(r){r.method==="get"&&r.hasAttribute("data-nette-compact")&&r.addEventListener("formdata",s=>this.compactCheckboxes(r,s.formData)),Array.from(r.elements).some(s=>s.getAttribute("data-nette-rules"))&&(this.toggleForm(r),!r.noValidate&&(r.noValidate=!0,r.addEventListener("submit",s=>{this.validateForm(s.submitter||r)||(s.stopImmediatePropagation(),s.preventDefault())}),r.addEventListener("reset",()=>{setTimeout(()=>this.toggleForm(r))})))}initOnLoad(){S(this,g,G).call(this,()=>{Array.from(document.forms).forEach(r=>this.initForm(r))})}}p=new WeakMap,w=new WeakMap,y=new WeakMap,g=new WeakSet,q=function(r,s){let n=r.elements.namedItem(s);return n instanceof RadioNodeList?n[0]:n},H=function(r){let s=r.form.elements.namedItem(r.name);return s instanceof RadioNodeList?Array.from(s):[s]},G=function(r){document.readyState!=="loading"?r.call(this):document.addEventListener("DOMContentLoaded",r)};let a={á:"a",ä:"a",č:"c",ď:"d",é:"e",ě:"e",í:"i",ľ:"l",ň:"n",ó:"o",ô:"o",ř:"r",š:"s",ť:"t",ú:"u",ů:"u",ý:"y",ž:"z"};function o(L){L=L.toLowerCase();let r="";for(let s=0;s<L.length;s++){let n=a[L.charAt(s)];r+=n||L.charAt(s)}return r.replace(/[^a-z0-9]+/g,"-").replace(/^-|-$/g,"")}var u="3.5.3";let f=new i;return f.version=u,f.webalize=o,f}))})(R)),R.exports}var _=Z();const tt=X(_),I=h=>{document.readyState==="loading"?document.addEventListener("DOMContentLoaded",h):h()};class et extends EventTarget{constructor(t){super(),this.naja=t,this.selector=".ajax",this.allowedOrigins=[window.location.origin],this.handler=this.handleUI.bind(this),t.addEventListener("init",this.initialize.bind(this))}initialize(){I(()=>this.bindUI(window.document.body)),this.naja.snippetHandler.addEventListener("afterUpdate",t=>{const{snippet:e}=t.detail;this.bindUI(e)})}bindUI(t){const e=`a${this.selector}`,i=f=>{f.removeEventListener("click",this.handler),f.addEventListener("click",this.handler)};if(t.matches(e))return i(t);t.querySelectorAll(e).forEach(f=>i(f));const o=f=>{f.removeEventListener("submit",this.handler),f.addEventListener("submit",this.handler)};if(t instanceof HTMLFormElement)return o(t);t.querySelectorAll("form").forEach(f=>o(f))}handleUI(t){const e=t.currentTarget,i=this.naja.prepareOptions(),a=()=>{};if(t instanceof MouseEvent){if(t.altKey||t.ctrlKey||t.shiftKey||t.metaKey||t.button)return;this.clickElement(e,i,t).catch(a);return}const{submitter:o}=t;(this.selector===""||e.matches(this.selector)||o!=null&&o.matches(this.selector))&&this.submitForm(o??e,i,t).catch(a)}async clickElement(t,e={},i){if(t instanceof HTMLAnchorElement)return this.processInteraction(t,"GET",t.href,null,e,i);if((t instanceof HTMLInputElement||t instanceof HTMLButtonElement)&&t.form)return this.submitForm(t,e,i);throw new Error("Unsupported element in clickElement(): element must be an anchor or a submitter element attached to a form.")}async submitForm(t,e={},i){let a,o=null;if((t instanceof HTMLInputElement||t instanceof HTMLButtonElement)&&t.form)a=t.form,o=t;else if(t instanceof HTMLFormElement)a=t,o=i instanceof SubmitEvent?i.submitter:null;else throw new Error("Unsupported element in submitForm(): formOrSubmitter must be either a form or a submitter element attached to a form.");const u=((o==null?void 0:o.getAttribute("formmethod"))??a.getAttribute("method")??"GET").toUpperCase(),f=(o==null?void 0:o.getAttribute("formaction"))??a.getAttribute("action")??window.location.pathname+window.location.search,p=new FormData(a,o);return this.processInteraction(o??a,u,f,p,e,i)}async processInteraction(t,e,i,a=null,o={},u){if(!this.dispatchEvent(new CustomEvent("interaction",{cancelable:!0,detail:{element:t,originalEvent:u,options:o}})))return u==null||u.preventDefault(),{};if(!this.isUrlAllowed(`${i}`))throw new Error(`Cannot dispatch async request, URL is not allowed: ${i}`);return u==null||u.preventDefault(),this.naja.makeRequest(e,i,a,o)}isUrlAllowed(t){const e=new URL(t,location.href);return e.origin==="null"?!1:this.allowedOrigins.includes(e.origin)}}class it{constructor(t){this.naja=t,t.addEventListener("init",this.initialize.bind(this)),t.uiHandler.addEventListener("interaction",this.processForm.bind(this))}initialize(){I(()=>this.initForms(window.document.body)),this.naja.snippetHandler.addEventListener("afterUpdate",t=>{const{snippet:e}=t.detail;this.initForms(e)})}initForms(t){const e=this.netteForms||window.Nette;if(!e)return;if(t instanceof HTMLFormElement){e.initForm(t);return}t.querySelectorAll("form").forEach(a=>e.initForm(a))}processForm(t){const{element:e,originalEvent:i}=t.detail,a=e instanceof HTMLFormElement,o=(e instanceof HTMLInputElement||e instanceof HTMLButtonElement)&&e.form;o&&(e.form["nette-submittedBy"]=e);const u=this.netteForms||window.Nette;(a||o)&&u&&!u.validateForm(e)&&(i==null||i.stopImmediatePropagation(),i==null||i.preventDefault(),t.preventDefault())}}class nt extends EventTarget{constructor(t){super(),this.naja=t,t.uiHandler.addEventListener("interaction",e=>{var o,u;const{element:i,options:a}=e.detail;if(i.hasAttribute("data-naja-force-redirect")||(o=i.form)!=null&&o.hasAttribute("data-naja-force-redirect")){const f=i.getAttribute("data-naja-force-redirect")??((u=i.form)==null?void 0:u.getAttribute("data-naja-force-redirect"));a.forceRedirect=f!=="off"}}),t.addEventListener("success",e=>{const{payload:i,options:a}=e.detail;i.redirect&&(this.makeRedirect(i.redirect,a.forceRedirect??!1,a),e.stopImmediatePropagation())}),this.locationAdapter={assign:e=>window.location.assign(e)}}makeRedirect(t,e,i={}){t instanceof URL&&(t=t.href);let a=e||!this.naja.uiHandler.isUrlAllowed(t);this.dispatchEvent(new CustomEvent("redirect",{cancelable:!0,detail:{url:t,setUrl(u){t=u},isHardRedirect:a,setHardRedirect(u){a=!!u},options:i}}))&&(a?this.locationAdapter.assign(t):this.naja.makeRequest("GET",t,null,i))}}class O extends EventTarget{constructor(t){super(),this.op={replace:{updateElement(e,i){e.innerHTML=i},updateIndex(e,i){return i}},prepend:{updateElement(e,i){e.insertAdjacentHTML("afterbegin",i)},updateIndex(e,i){return i+e}},append:{updateElement(e,i){e.insertAdjacentHTML("beforeend",i)},updateIndex(e,i){return e+i}}},t.addEventListener("success",e=>{const{options:i,payload:a}=e.detail;a.snippets&&this.updateSnippets(a.snippets,!1,i)})}static findSnippets(t,e=window.document){const i={};return e.querySelectorAll('[id^="snippet-"]').forEach(o=>{((t==null?void 0:t(o))??!0)&&(i[o.id]=o.innerHTML)}),i}async updateSnippets(t,e=!1,i={}){await Promise.all(Object.keys(t).map(async a=>{const o=document.getElementById(a);o&&await this.updateSnippet(o,t[a],e,i)}))}async updateSnippet(t,e,i,a){let o=this.op.replace;if((t.hasAttribute("data-naja-snippet-prepend")||t.hasAttribute("data-ajax-prepend"))&&!i?o=this.op.prepend:(t.hasAttribute("data-naja-snippet-append")||t.hasAttribute("data-ajax-append"))&&!i&&(o=this.op.append),!this.dispatchEvent(new CustomEvent("beforeUpdate",{cancelable:!0,detail:{snippet:t,content:e,fromCache:i,operation:o,changeOperation(w){o=w},options:a}})))return;this.dispatchEvent(new CustomEvent("pendingUpdate",{detail:{snippet:t,content:e,fromCache:i,operation:o,options:a}}));const p=(typeof o=="function"?o:o.updateElement)(t,e);p instanceof Promise&&await p,this.dispatchEvent(new CustomEvent("afterUpdate",{detail:{snippet:t,content:e,fromCache:i,operation:o,options:a}}))}}const B=Symbol();class T extends EventTarget{constructor(t){super(),this.naja=t,this.initialized=!1,this.cursor=0,this.popStateHandler=this.handlePopState.bind(this),t.addEventListener("init",this.initialize.bind(this)),t.addEventListener("before",this.saveUrl.bind(this)),t.addEventListener("before",this.saveOriginalTitle.bind(this)),t.addEventListener("before",this.replaceInitialStateBeforeRequest.bind(this)),t.addEventListener("success",this.pushNewState.bind(this)),t.redirectHandler.addEventListener("redirect",this.saveRedirectedUrl.bind(this)),t.uiHandler.addEventListener("interaction",this.configureMode.bind(this)),this.historyAdapter={get state(){return window.history.state},replaceState:(e,i,a)=>window.history.replaceState(e,i,a),pushState:(e,i,a)=>window.history.pushState(e,i,a)}}set uiCache(t){console.warn("Naja: HistoryHandler.uiCache is deprecated, use options.snippetCache instead."),this.naja.defaultOptions.snippetCache=t}handlePopState(t){const{state:e}=t;if((e==null?void 0:e.source)!=="naja")return;this.replaceInitialState();const i=e.cursor-this.cursor;this.cursor=e.cursor;const a=this.naja.prepareOptions();this.dispatchEvent(new CustomEvent("restoreState",{detail:{state:e,direction:i,options:a}}))}initialize(){var t;window.addEventListener("popstate",this.popStateHandler),((t=this.historyAdapter.state)==null?void 0:t.source)==="naja"&&(this.cursor=this.historyAdapter.state.cursor,this.replaceInitialState())}saveOriginalTitle(t){const{options:e}=t.detail;e[B]=window.document.title}saveUrl(t){const{url:e,options:i}=t.detail;i.href??(i.href=e)}saveRedirectedUrl(t){const{url:e,options:i}=t.detail;i.href=e}replaceInitialStateBeforeRequest(t){const{options:e}=t.detail;T.normalizeMode(e.history)!==!1&&this.replaceInitialState(e)}replaceInitialState(t=this.naja.prepareOptions()){this.initialized||(I(()=>this.historyAdapter.replaceState(this.buildState(window.location.href,"replace",this.cursor,t),window.document.title,window.location.href)),this.initialized=!0)}configureMode(t){var a,o;const{element:e,options:i}=t.detail;if(e.hasAttribute("data-naja-history")||(a=e.form)!=null&&a.hasAttribute("data-naja-history")){const u=e.getAttribute("data-naja-history")??((o=e.form)==null?void 0:o.getAttribute("data-naja-history"));i.history=T.normalizeMode(u)}}static normalizeMode(t){return t==="off"||t===!1?!1:t==="replace"?"replace":!0}pushNewState(t){const{payload:e,options:i}=t.detail,a=T.normalizeMode(i.history);if(a===!1)return;e.postGet&&e.url&&(i.href=e.url);const o=a==="replace"?"replaceState":"pushState",u=a==="replace"?this.cursor:++this.cursor,f=this.buildState(i.href,a,u,i),p=window.document.title;window.document.title=i[B],this.historyAdapter[o](f,p,i.href),window.document.title=p}buildState(t,e,i,a){const o={source:"naja",cursor:i,href:t};return this.dispatchEvent(new CustomEvent("buildState",{detail:{state:o,operation:e==="replace"?"replaceState":"pushState",isInitial:!this.initialized,options:a}})),o}}class C extends EventTarget{constructor(t){super(),this.naja=t,this.initialized=!1,this.currentSnippets=new Map,this.storages={off:new rt(t),history:new st,session:new at},t.addEventListener("init",this.initializeIndex.bind(this)),t.snippetHandler.addEventListener("pendingUpdate",this.updateIndex.bind(this)),t.uiHandler.addEventListener("interaction",this.configureCache.bind(this)),t.historyHandler.addEventListener("buildState",this.buildHistoryState.bind(this)),t.historyHandler.addEventListener("restoreState",this.restoreHistoryState.bind(this))}resolveStorage(t){let e;return t===!0||t===void 0?e="history":t===!1?e="off":e=t,this.storages[e]}static shouldCacheSnippet(t){return!t.hasAttribute("data-naja-history-nocache")&&!t.hasAttribute("data-history-nocache")&&(!t.hasAttribute("data-naja-snippet-cache")||t.getAttribute("data-naja-snippet-cache")!=="off")}initializeIndex(){this.initialized||(I(()=>{const t=O.findSnippets(C.shouldCacheSnippet);this.currentSnippets=new Map(Object.entries(t))}),this.initialized=!0)}updateIndex(t){const{snippet:e,content:i,operation:a}=t.detail;if(!C.shouldCacheSnippet(e))return;const o=this.currentSnippets.get(e.id)??"",u=typeof a=="object"?a.updateIndex:()=>i;this.currentSnippets.set(e.id,u(o,i));const f=C.parser.parseFromString(i,"text/html"),p=O.findSnippets(C.shouldCacheSnippet,f);for(const[w,y]of Object.entries(p))this.currentSnippets.set(w,y)}configureCache(t){var a,o,u,f;const{element:e,options:i}=t.detail;if(e&&(e.hasAttribute("data-naja-snippet-cache")||(a=e.form)!=null&&a.hasAttribute("data-naja-snippet-cache")||e.hasAttribute("data-naja-history-cache")||(o=e.form)!=null&&o.hasAttribute("data-naja-history-cache"))){const p=e.getAttribute("data-naja-snippet-cache")??((u=e.form)==null?void 0:u.getAttribute("data-naja-snippet-cache"))??e.getAttribute("data-naja-history-cache")??((f=e.form)==null?void 0:f.getAttribute("data-naja-history-cache"));i.snippetCache=p}}buildHistoryState(t){const{isInitial:e,state:i,options:a}=t.detail;"historyUiCache"in a&&(console.warn("Naja: options.historyUiCache is deprecated, use options.snippetCache instead."),a.snippetCache=a.historyUiCache),e&&this.initializeIndex();const o=Object.keys(O.findSnippets(C.shouldCacheSnippet)),u=Object.fromEntries(Array.from(this.currentSnippets).filter(([p])=>o.includes(p)));if(!this.dispatchEvent(new CustomEvent("store",{cancelable:!0,detail:{snippets:u,state:i,options:a}})))return;const f=this.resolveStorage(a.snippetCache);i.snippets={storage:f.type,key:f.store(u)}}restoreHistoryState(t){const{state:e,options:i}=t.detail;if(e.snippets===void 0||(i.snippetCache=e.snippets.storage,!this.dispatchEvent(new CustomEvent("fetch",{cancelable:!0,detail:{state:e,options:i}}))))return;const o=this.resolveStorage(i.snippetCache).fetch(e.snippets.key,e,i);o!==null&&this.dispatchEvent(new CustomEvent("restore",{cancelable:!0,detail:{snippets:o,state:e,options:i}}))&&this.naja.snippetHandler.updateSnippets(o,!0,i)}}C.parser=new DOMParser;class rt{constructor(t){this.naja=t,this.type="off"}store(){return null}fetch(t,e,i){return this.naja.makeRequest("GET",e.href,null,{...i,history:!1,snippetCache:!1}),null}}class st{constructor(){this.type="history"}store(t){return t}fetch(t){return t}}class at{constructor(){this.type="session"}store(t){const e=Math.random().toString(36).substring(2,8);return window.sessionStorage.setItem(e,JSON.stringify(t)),e}fetch(t){const e=window.sessionStorage.getItem(t);return e===null?null:JSON.parse(e)}}class k{constructor(t){this.naja=t,this.loadedScripts=new Set,t.addEventListener("init",this.initialize.bind(this))}initialize(){I(()=>{document.querySelectorAll("script[data-naja-script-id]").forEach(t=>{const e=t.getAttribute("data-naja-script-id");e!==null&&e!==""&&this.loadedScripts.add(e)})}),this.naja.snippetHandler.addEventListener("afterUpdate",t=>{const{content:e}=t.detail;this.loadScripts(e)})}loadScripts(t){if(typeof t=="string"){this.loadScriptsInSnippet(t);return}Object.keys(t).forEach(e=>{const i=t[e];this.loadScriptsInSnippet(i)})}loadScriptsInSnippet(t){if(!/<script/i.test(t))return;k.parser.parseFromString(t,"text/html").querySelectorAll("script").forEach(a=>{const o=a.getAttribute("data-naja-script-id");if(o!==null&&o!==""&&this.loadedScripts.has(o))return;const u=window.document.createElement("script");if(u.innerHTML=a.innerHTML,a.hasAttributes())for(const f of a.attributes)u.setAttribute(f.name,f.value);window.document.head.appendChild(u).parentNode.removeChild(u),o!==null&&o!==""&&this.loadedScripts.add(o)})}}k.parser=new DOMParser;class ot extends EventTarget{constructor(t,e,i,a,o,u,f){super(),this.VERSION=3,this.initialized=!1,this.extensions=[],this.defaultOptions={},this.uiHandler=new(t??et)(this),this.redirectHandler=new(e??nt)(this),this.snippetHandler=new(i??O)(this),this.formsHandler=new(a??it)(this),this.historyHandler=new(o??T)(this),this.snippetCache=new(u??C)(this),this.scriptLoader=new(f??k)(this)}registerExtension(t){this.initialized&&t.initialize(this),this.extensions.push(t)}initialize(t={}){if(this.initialized)throw new Error("Cannot initialize Naja, it is already initialized.");this.defaultOptions=this.prepareOptions(t),this.extensions.forEach(e=>e.initialize(this)),this.dispatchEvent(new CustomEvent("init",{detail:{defaultOptions:this.defaultOptions}})),this.initialized=!0}prepareOptions(t){return{...this.defaultOptions,...t,fetch:{...this.defaultOptions.fetch,...t==null?void 0:t.fetch}}}async makeRequest(t,e,i=null,a={}){typeof e=="string"&&(e=new URL(e,location.href)),a=this.prepareOptions(a);const o=new Headers(a.fetch.headers||{}),u=this.transformData(e,t,i),f=new AbortController,p=new Request(e.toString(),{credentials:"same-origin",...a.fetch,method:t,headers:o,body:u,signal:f.signal});if(p.headers.set("X-Requested-With","XMLHttpRequest"),p.headers.set("Accept","application/json"),!this.dispatchEvent(new CustomEvent("before",{cancelable:!0,detail:{request:p,method:t,url:e.toString(),data:i,options:a}})))return{};const w=window.fetch(p);this.dispatchEvent(new CustomEvent("start",{detail:{request:p,promise:w,abortController:f,options:a}}));let y,g;try{if(y=await w,!y.ok)throw new lt(y);g=await y.json()}catch(x){if(x.name==="AbortError")return this.dispatchEvent(new CustomEvent("abort",{detail:{request:p,error:x,options:a}})),this.dispatchEvent(new CustomEvent("complete",{detail:{request:p,response:y,payload:void 0,error:x,options:a}})),{};throw this.dispatchEvent(new CustomEvent("error",{detail:{request:p,response:y,error:x,options:a}})),this.dispatchEvent(new CustomEvent("complete",{detail:{request:p,response:y,payload:void 0,error:x,options:a}})),x}return this.dispatchEvent(new CustomEvent("payload",{detail:{request:p,response:y,payload:g,options:a}})),this.dispatchEvent(new CustomEvent("success",{detail:{request:p,response:y,payload:g,options:a}})),this.dispatchEvent(new CustomEvent("complete",{detail:{request:p,response:y,payload:g,error:void 0,options:a}})),g}appendToQueryString(t,e,i){if(i!=null)if(Array.isArray(i)||Object.getPrototypeOf(i)===Object.prototype)for(const[a,o]of Object.entries(i))this.appendToQueryString(t,`${e}[${a}]`,o);else t.append(e,String(i))}transformData(t,e,i){const a=["GET","HEAD"].includes(e.toUpperCase());if(a&&i instanceof FormData){for(const[u,f]of i)f!=null&&t.searchParams.append(u,String(f));return null}if(i!==null&&Object.getPrototypeOf(i)===Object.prototype||Array.isArray(i)){const u=a?t.searchParams:new URLSearchParams;for(const[f,p]of Object.entries(i))this.appendToQueryString(u,f,p);return a?null:u}return i}}class lt extends Error{constructor(t){const e=`HTTP ${t.status}: ${t.statusText}`;super(e),this.name=this.constructor.name,this.stack=new Error(e).stack,this.response=t}}class dt{constructor(){this.abortControllers=new Set}initialize(t){t.uiHandler.addEventListener("interaction",this.checkAbortable.bind(this)),t.addEventListener("init",this.onInitialize.bind(this)),t.addEventListener("start",this.saveAbortController.bind(this)),t.addEventListener("complete",this.removeAbortController.bind(this))}onInitialize(){document.addEventListener("keydown",t=>{if(t.key==="Escape"&&!(t.ctrlKey||t.shiftKey||t.altKey||t.metaKey)){for(const e of this.abortControllers)e.abort();this.abortControllers.clear()}})}checkAbortable(t){var a,o;const{element:e,options:i}=t.detail;(e.hasAttribute("data-naja-abort")||(a=e.form)!=null&&a.hasAttribute("data-naja-abort"))&&(i.abort=(e.getAttribute("data-naja-abort")??((o=e.form)==null?void 0:o.getAttribute("data-naja-abort")))!=="off")}saveAbortController(t){const{abortController:e,options:i}=t.detail;i.abort!==!1&&(this.abortControllers.add(e),i.clearAbortExtension=()=>this.abortControllers.delete(e))}removeAbortController(t){const{options:e}=t.detail;e.abort!==!1&&e.clearAbortExtension&&e.clearAbortExtension()}}class ut{constructor(){this.abortControllers=new Map}initialize(t){t.uiHandler.addEventListener("interaction",this.checkUniqueness.bind(this)),t.addEventListener("start",this.abortPreviousRequest.bind(this)),t.addEventListener("complete",this.clearRequest.bind(this))}checkUniqueness(t){var a,o;const{element:e,options:i}=t.detail;if(e.hasAttribute("data-naja-unique")??((a=e.form)==null?void 0:a.hasAttribute("data-naja-unique"))){const u=e.getAttribute("data-naja-unique")??((o=e.form)==null?void 0:o.getAttribute("data-naja-unique"));i.unique=u==="off"?!1:u??"default"}}abortPreviousRequest(t){var a;const{abortController:e,options:i}=t.detail;i.unique!==!1&&((a=this.abortControllers.get(i.unique??"default"))==null||a.abort(),this.abortControllers.set(i.unique??"default",e))}clearRequest(t){const{request:e,options:i}=t.detail;!e.signal.aborted&&i.unique!==!1&&this.abortControllers.delete(i.unique??"default")}}const N=new ot;N.registerExtension(new dt);N.registerExtension(new ut);tt.initOnLoad();document.addEventListener("DOMContentLoaded",()=>{N.initialize()});
